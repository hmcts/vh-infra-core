parameters:
  - name: tfversion
    type: string

steps:
#  - template: keyvault-read.yaml
#    parameters:
#      serviceConnection: $(serviceConnection)
#      environment: ${{ parameters.environment }}

  - script: cd $(System.DefaultWorkingDirectory)/vh-infra-core  
  - task: TerraformInstaller@1
    displayName: 'Install Terraform ${{ parameters.tfversion }}'
    inputs:
      terraformVersion: ${{ parameters.tfversion }}

  - task: TerraformCLI@1
    displayName: 'Terraform init'
    inputs:
      command: 'init'
      commandOptions: '-backend=false -input=false'
      workingDirectory: 'terraform'

  - template: templates/tests/terraform/allTests.yaml@templates
    parameters:
      terraformPath: '$(System.DefaultWorkingDirectory)/vh-infra-core/terraform'